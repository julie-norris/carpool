{% extends 'base.html' %}
{% block content %}
  <head>
    <meta charset="UTF-8">
    <title>Route Map</title>
    <style>
       #map {
        height: 400px;
        width: 100%;
       }
    </style>
  </head>
    <body>
      <div id="map"></div>
      <script>
      var map, infoWindow;
      var directionsService;
      

      function initMap() {
        var myLatLong = {lat:37.765, lng:-122.241 };
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: myLatLong
        });
        directionsService = new google.maps.DirectionsService();
        infoWindow = new google.maps.InfoWindow;
        new AutocompleteDirectionsHandler(map);
    }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent('You are Here!');
          infoWindow.open(map);
          map.setCenter(pos);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        handleLocationError(false, infoWindow, map.getCenter());
      }
        // marker.setPlace({
        //       placeId: place.place_id,
        //       location: place.geometry.location
        //     });
        //     marker.setVisible(true);
        //     infowindowContent.children['place-name'].textContent = place.name;
        //     infowindowContent.children['place-id'].textContent = place.place_id;
        //     infowindowContent.children['place-address'].textContent =
        //         place.formatted_address;
        //     infowindow.open(map, marker);
      function AutocompleteDirectionsHandler(map) {
        this.map = map;
        this.destinationPlaceID = null;
        this.travelMode = 'DRIVING';
        var rider_destination = document.getElementById('rider_destination');

        var destinationAutocomplete = new google.maps.places.Autocomplete(rider_destination, {placeIdOnly: true});

        this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(rider_destination);
 
      }
      

  
      function handleLocationError(browserHasGeolocation,  infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your Browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

    </script>
<form>    
    <div>
      <label>Please input your destination address:</label>
      <input type='text' id='rider_destination' >
    </div>

    <div>
      <h1>What date and time do you want to arrive?</h1>
      <div id="datepicker">
    <p>Date: <input type="date" name='date' ></p>
     <p>Arrival Time (use only 15 minute increments): <input type="time" name="arrival_time"></p>
    
  </div>
  </div>
  <br>
    <br>
      <input type="submit">
</form>      
    </body>
  <script src="https://code.jquery.com/jquery.js"></script>
  <script> $('#rider_destination').on('blur', AutocompleteDirectionsHandler);</script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5tDzhP-TkpUOI4dOZzkATen2OUCPasf4&callback=initMap&libraries=places"
        async defer></script>
  
  
  
{% endblock %}
